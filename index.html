<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bingo - Jogo Funcional</title>

<!-- Manifesto e cor do app -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#06b6d4">

<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#06b6d4;
    --muted:#94a3b8;
    --success:#10b981;
    --danger:#ef4444;
    --glass: rgba(255,255,255,0.03);
    --tile-size: calc((100vw - 48px) / 5);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:linear-gradient(180deg,#071025 0%, #07182b 60%);
    color:#e6eef8;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:18px;
  }

  header{
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:14px;
  }
  h1{font-size:18px;margin:0}
  .controls{
    display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap;
  }
  .panel{
    background:var(--glass);
    padding:12px;
    border-radius:12px;
    box-shadow:0 6px 18px rgba(2,6,23,0.6);
    width:100%;
    margin-bottom:12px;
  }

  .top-row{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
  .left-controls{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
  label{font-size:13px;color:var(--muted)}

  input[type=number]{
    width:70px;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.06);
    background:transparent;
    color:inherit;
  }

  button{
    background:linear-gradient(180deg,var(--accent), #05a5bc);
    border:0;
    color:#042027;
    padding:10px 14px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 6px 18px rgba(5,90,100,0.12);
  }
  button.secondary{
    background:transparent;
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.04);
    box-shadow:none;
  }
  .small{padding:8px 10px;font-size:14px}

  main{display:flex; gap:12px; flex-direction:column;}

  .cards{
    display:flex;
    gap:12px;
    overflow:auto;
    padding-bottom:8px;
  }

  .card{
    min-width:260px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:8px;
    flex:0 0 320px;
    box-shadow:0 8px 20px rgba(0,0,0,0.45);
  }

  .card-header{
    display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;
  }
  .bingo-title{display:flex; gap:8px; align-items:center; font-weight:700; letter-spacing:2px}
  .bingo-title span{font-size:12px;color:var(--muted)}

  .grid{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:6px;
  }

  .cell{
    background:rgba(255,255,255,0.02);
    border-radius:8px;
    padding:12px 6px;
    height:54px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:18px;
    color:inherit;
    user-select:none;
    cursor:pointer;
    transition:transform .12s, box-shadow .12s, background .12s;
  }
  .cell:active{transform:translateY(1px)}
  .cell.free{
    background:linear-gradient(180deg,#fff1 0%, #fff1 100%);
    color:var(--accent);
    font-size:13px;
  }

  .cell.marked{
    background:linear-gradient(180deg,var(--success), #0ea06f);
    color:#042027;
    box-shadow:0 6px 14px rgba(2,110,78,0.18);
  }
  .cell.bingo{
    outline:3px solid rgba(255,255,255,0.06);
    box-shadow:0 10px 30px rgba(16,185,129,0.12);
  }

  .letters{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:6px;
    margin-bottom:8px;
  }
  .letter{
    background:transparent;
    text-align:center;
    font-weight:800;
    letter-spacing:2px;
    color:var(--muted);
    font-size:12px;
  }

  .drawn-area{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }

  .drawn-list{
    display:flex;
    gap:6px;
    flex-wrap:wrap;
  }
  .drawn-tile{
    width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.02);
    display:flex;align-items:center;justify-content:center;font-weight:700;
    border:1px solid rgba(255,255,255,0.02);
  }
  .drawn-tile.drawn { background:linear-gradient(180deg,#fff1, #fff1); color:var(--accent); border:0; }

  .status{
    font-size:14px;
    color:var(--muted);
    margin-left:8px;
  }

  .notice{
    margin-top:10px;
    padding:10px;
    border-radius:10px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    font-weight:600;
    color:var(--muted);
  }

  footer{margin-top:14px;color:var(--muted);font-size:13px}

  @media(min-width:880px){
    main{flex-direction:row;align-items:flex-start}
    .cards{flex-wrap:wrap}
    .controls {justify-content:flex-start}
    .panel{width:360px}
    .cards-wrapper{flex:1}
  }
</style>
</head>
<body>
<header>
  <div style="flex:1">
    <h1>Bingo â€” Jogador mÃ³vel</h1>
    <div style="color:var(--muted); font-size:13px; margin-top:6px">
      Cartelas 5Ã—5 (B I N G O). Centro Ã© "FREE". Toque para marcar. Ganha quem fizer Bingo (linha/coluna/diagonal/cheia).
    </div>
  </div>
  <div style="width:120px; text-align:right">
    <div style="font-size:12px;color:var(--muted)">NÃºmeros restantes</div>
    <div id="remaining" style="font-weight:800; font-size:18px">75</div>
  </div>
</header>

<div class="top-row panel">
  <div class="left-controls">
    <label for="count">Cartelas</label>
    <input id="count" type="number" min="1" max="6" value="1" />
    <button id="gen" class="small">Gerar</button>

    <button id="drawNext" class="small">Sortear prÃ³ximo</button>
    <button id="autoDraw" class="small secondary">Sortear todos</button>
    <button id="reset" class="small secondary">Resetar</button>
  </div>

  <div style="text-align:right">
    <div style="font-size:12px;color:var(--muted)">Ãšltimo sorteado</div>
    <div id="lastDraw" style="font-size:20px; font-weight:800">â€”</div>
  </div>
</div>

<main>
  <section class="panel cards-wrapper">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px">
      <div style="font-weight:700">Cartelas</div>
      <div class="controls">
        <div id="bingoAlert" style="display:none;color:var(--success); font-weight:800">BINGO! ðŸŽ‰</div>
      </div>
    </div>

    <div class="cards" id="cards"></div>
  </section>

  <aside class="panel" style="width:330px; max-width:100%">
    <div style="font-weight:800; margin-bottom:6px">NÃºmeros sorteados</div>
    <div class="drawn-area">
      <div class="drawn-list" id="drawnList" aria-live="polite" style="flex:1"></div>
    </div>

    <div class="notice" id="notice">Toque em um nÃºmero da cartela para marcar manualmente. NÃºmeros sorteados sÃ£o marcados automaticamente.</div>
  </aside>
</main>

<footer>
  Feito por vocÃª â€” versÃ£o PWA. Instale na tela inicial para jogar offline ðŸŽ‰
</footer>

<script>
(() => {
  const MAX = 75;
  let drawPile = [];
  let drawn = [];
  let autoInterval = null;
  const cardsContainer = document.getElementById('cards');
  const drawnListEl = document.getElementById('drawnList');
  const remainingEl = document.getElementById('remaining');
  const lastDrawEl = document.getElementById('lastDraw');
  const bingoAlertEl = document.getElementById('bingoAlert');

  function shuffle(array){
    for(let i = array.length -1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function makeDrawPile(){
    drawPile = shuffle(Array.from({length:MAX}, (_,i)=>i+1));
    drawn = [];
    updateDrawnUI();
  }

  function drawNext(){
    if(drawPile.length === 0) return null;
    const num = drawPile.shift();
    drawn.push(num);
    updateDrawnUI();
    markNumberOnCards(num);
    return num;
  }

  function updateDrawnUI(){
    drawnListEl.innerHTML = '';
    const drawnSet = new Set(drawn);
    for(let i=1;i<=MAX;i++){
      const tile = document.createElement('div');
      tile.className = 'drawn-tile' + (drawnSet.has(i) ? ' drawn' : '');
      tile.textContent = i;
      drawnListEl.appendChild(tile);
    }
    remainingEl.textContent = (MAX - drawn.length);
    lastDrawEl.textContent = drawn.length ? drawn[drawn.length-1] : 'â€”';
  }

  function createCardData(){
    // Standard BINGO ranges
    const ranges = [
      [1,15],
      [16,30],
      [31,45],
      [46,60],
      [61,75]
    ];
    const grid = Array.from({length:5}, ()=>Array(5).fill(null));
    for(let col=0; col<5; col++){
      const [a,b] = ranges[col];
      const nums = [];
      for(let n=a;n<=b;n++) nums.push(n);
      shuffle(nums);
      for(let row=0; row<5; row++){
        grid[row][col] = nums[row];
      }
    }
    // Center free
    grid[2][2] = 'FREE';
    return grid;
  }

  function renderCards(n=1){
    cardsContainer.innerHTML = '';
    for(let i=0;i<n;i++){
      const cardData = createCardData();
      const cardEl = makeCardElement(cardData, i);
      cardsContainer.appendChild(cardEl);
    }
  }

  function makeCardElement(grid, index){
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.index = index;

    const header = document.createElement('div');
    header.className = 'card-header';
    header.innerHTML = `<div class="bingo-title"><div style="font-size:12px;color:var(--muted)">Cartela</div><span>#${index+1}</span></div>
                        <div style="font-size:12px;color:var(--muted)">Toque para marcar</div>`;
    el.appendChild(header);

    const letters = document.createElement('div');
    letters.className = 'letters';
    ['B','I','N','G','O'].forEach(l=>{
      const d = document.createElement('div');
      d.className = 'letter';
      d.textContent = l;
      letters.appendChild(d);
    });
    el.appendChild(letters);

    const gridEl = document.createElement('div');
    gridEl.className = 'grid';
    // store state
    el._state = {marked: Array.from({length:5}, ()=>Array(5).fill(false)), grid};

    for(let r=0;r<5;r++){
      for(let c=0;c<5;c++){
        const value = grid[r][c];
        const cell = document.createElement('div');
        cell.className = 'cell' + (value==='FREE' ? ' free' : '');
        cell.dataset.r = r;
        cell.dataset.c = c;
        cell.textContent = value;
        if(value === 'FREE'){
          el._state.marked[r][c] = true;
          cell.classList.add('marked');
        }
        cell.addEventListener('click', ()=> {
          toggleMark(el, r, c);
        });
        gridEl.appendChild(cell);
      }
    }
    el.appendChild(gridEl);
    return el;
  }

  function toggleMark(cardEl, r, c){
    const state = cardEl._state;
    // can't toggle FREE
    if(state.grid[r][c] === 'FREE') return;
    state.marked[r][c] = !state.marked[r][c];
    updateCardVisual(cardEl);
    if(checkBingo(cardEl)){
      announceBingo(cardEl);
    }
  }

  function updateCardVisual(cardEl){
    const cells = cardEl.querySelectorAll('.cell');
    cells.forEach(cell=>{
      const r = +cell.dataset.r;
      const c = +cell.dataset.c;
      if(cardEl._state.marked[r][c]) cell.classList.add('marked');
      else cell.classList.remove('marked');
    });
  }

  function markNumberOnCards(num){
    bingoAlertEl.style.display = 'none';
    const cards = cardsContainer.querySelectorAll('.card');
    cards.forEach(card=>{
      const grid = card._state.grid;
      for(let r=0;r<5;r++){
        for(let c=0;c<5;c++){
          if(grid[r][c] === num){
            card._state.marked[r][c] = true;
          }
        }
      }
      updateCardVisual(card);
      if(checkBingo(card)){
        announceBingo(card);
      }
    });
  }

  function checkBingo(cardEl){
    const m = cardEl._state.marked;
    // rows
    for(let r=0;r<5;r++){
      let ok=true;
      for(let c=0;c<5;c++) if(!m[r][c]) {ok=false; break;}
      if(ok) return {type:'row', index:r};
    }
    // cols
    for(let c=0;c<5;c++){
      let ok=true;
      for(let r=0;r<5;r++) if(!m[r][c]) {ok=false; break;}
      if(ok) return {type:'col', index:c};
    }
    // main diagonal
    let ok = true;
    for(let i=0;i<5;i++) if(!m[i][i]) {ok=false; break;}
    if(ok) return {type:'diag', index:0};
    // anti-diagonal
    ok = true;
    for(let i=0;i<5;i++) if(!m[i][4-i]) {ok=false; break;}
    if(ok) return {type:'diag', index:1};

    // full card
    ok = true;
    for(let r=0;r<5;r++) for(let c=0;c<5;c++) if(!m[r][c]) ok=false;
    if(ok) return {type:'full'};
    return false;
  }

  function announceBingo(cardEl){
    // highlight cells (simple)
    const cells = cardEl.querySelectorAll('.cell');
    cells.forEach(cell => cell.classList.add('bingo'));
    bingoAlertEl.style.display = 'inline-block';
    bingoAlertEl.textContent = 'BINGO! ðŸŽ‰';
    // small vibration on mobile if available
    if(navigator.vibrate) navigator.vibrate([100,60,100]);
  }

  // controls
  document.getElementById('gen').addEventListener('click', ()=>{
    const n = Math.max(1, Math.min(6, +document.getElementById('count').value || 1));
    stopAuto();
    makeDrawPile();
    renderCards(n);
    updateDrawnUI();
    bingoAlertEl.style.display='none';
  });

  document.getElementById('drawNext').addEventListener('click', ()=>{
    const num = drawNext();
    if(num === null) {
      alert('Todos os nÃºmeros jÃ¡ foram sorteados.');
    }
  });

  document.getElementById('reset').addEventListener('click', ()=>{
    if(confirm('Resetar tudo e gerar nova pilha de sorteio?')){
      stopAuto();
      makeDrawPile();
      renderCards( +document.getElementById('count').value || 1 );
      bingoAlertEl.style.display='none';
      updateDrawnUI();
    }
  });

  document.getElementById('autoDraw').addEventListener('click', ()=>{
    if(autoInterval){
      stopAuto();
      return;
    }
    // draw all automatically with short delay
    autoInterval = setInterval(() => {
      if(drawPile.length === 0){
        stopAuto();
      } else {
        drawNext();
      }
    }, 350);
    document.getElementById('autoDraw').textContent = 'Parar auto';
    document.getElementById('autoDraw').classList.remove('secondary');
  });

  function stopAuto(){
    if(autoInterval) clearInterval(autoInterval);
    autoInterval = null;
    document.getElementById('autoDraw').textContent = 'Sortear todos';
    document.getElementById('autoDraw').classList.add('secondary');
  }

  // init
  makeDrawPile();
  renderCards(1);
  updateDrawnUI();

  // keyboard: space -> sortear (desktop convenience)
  document.addEventListener('keydown', e=>{
    if(e.code === 'Space') {
      e.preventDefault();
      drawNext();
    }
  });

})();
</script>

<!-- Registro do Service Worker -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("sw.js")
      .then(reg => console.log("ServiceWorker registrado:", reg.scope))
      .catch(err => console.error("SW falhou:", err));
  });
}
</script>
</body>
</html>
